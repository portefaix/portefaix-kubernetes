---
# Copyright (C) Nicolas Lamirault <nicolas.lamirault@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0

openfga:
  replicaCount: 1
  resources:
    limits:
      memory: 256Mi
    requests:
      cpu: 20m
      memory: 64Mi

  datastore:
    engine: postgres
    # uri: "postgres://iam:iam@postgresql.default.svc.cluster.local/openfga?sslmode=disable"
    uriSecret: openfga-database-credentials
    migrations:
      resources:
        limits:
          memory: 100Mi
        requests:
          cpu: 5m
          memory: 10Mi

  ingress:
    enabled: true
    className: traefik
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: web
      # traefik.ingress.kubernetes.io/router.tls: "true"
    hosts:
    - host: openfga.192.168.0.61.nip.io
      paths:
      - path: /
        pathType: ImplementationSpecific

database:
  image: ghcr.io/cloudnative-pg/postgresql:16
  cluster: openfga
  config:
    database: openfga
  storage:
    storageClass: local-path
    size: 2Gi
    # walSize: 2Gi
  backup:
    enabled: false
    #   suspend: "false"
    #   immediate: "true"
    #   target: primary
    #   schedule: "0 17 23 * * *"
    #   backupOwnerReference: self
    #   retentionPolicy: 7d
    s3:
      bucket: portefaix-homelab-openfga
  resources:
    limits:
      memory: "1Gi"
    requests:
      memory: "300Mi"
      cpu: "20m"
