# SPDX-FileCopyrightText: Copyright (C) Nicolas Lamirault <nicolas.lamirault@gmail.com>
# SPDX-License-Identifier: Apache-2.0

---
karpenter:
  controller:
    resources:
      limits:
        # cpu: 1
        memory: 1Gi
      requests:
        cpu: 500m
        memory: 256Mi
  webhook:
    resources:
      limits:
        # cpu: 100m
        memory: 50Mi
      requests:
        cpu: 200m
        memory: 150Mi
  clusterName: portefaix-staging-eks
  aws:
    defaultInstanceProfile: KarpenterNodeInstanceProfile-portefaix-staging-eks
    interruptionQueueName: portefaix-staging-eks

nodepools:
- name: networking
  labels:
    service: networking
  additionnalLabels:
    kubernetes.azure.com/mode: "system"
    # required for Karpenter to predict overhead from cilium DaemonSet
    kubernetes.azure.com/ebpf-dataplane: cilium
  requirements:
    arch: ["amd64", "arm64"]
    os: ["linux"]
    capacityType: ["on-demand"]
    additionnals:
    - key: karpenter.azure.com/sku-family
      operator: In
      values: [D]
  cilium:
    enabled: true
  taints:
    - key: "role"
      value: "networking"
      effect: "NoSchedule"
  nodeClass: "karpenter-default"
  limits:
    cpu: "20"
    memory: "64Gi"
  disruption:
    maxUnavailable: 1

azure:
  enabled: true
  aksNodeClass:
  - name: AzureLinux
    osDiskSizeGB: 100
  - name: Ubuntu2204
    osDiskSizeGB: 100
