# Copyright (C) Nicolas Lamirault <nicolas.lamirault@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
vector:
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 256Mi

  env:
  - name: LOGDNA_API_KEY
    valueFrom:
      secretKeyRef:
        name: vector
        key: LOGDNA_API_KEY
  - name: HONEYCOMB_API_KEY
    valueFrom:
      secretKeyRef:
        name: vector
        key: HONEYCOMB_API_KEY
  - name: LOGZIO_TOKEN
    valueFrom:
      secretKeyRef:
        name: vector
        key: LOGZIO_TOKEN
  - name: PAPERTRAIL_ENDPOINT
    valueFrom:
      secretKeyRef:
        name: vector
        key: PAPERTRAIL_ENDPOINT
  - name: LOGTAIL_TOKEN
    valueFrom:
      secretKeyRef:
        name: vector
        key: LOGTAIL_TOKEN

  customConfig:
    api:
      enabled: true
      address: 127.0.0.1:8686
      playground: false
    sources:
      kubernetes:
        type: kubernetes_logs
    transforms:
      logtail:
        type: remap
        inputs:
          - kubernetes
        source: |-
          .dt = del(.timestamp)
    sinks:
      # console:
      #   type: console
      #   inputs:
      #     - kubernetes
      #   target: stdout
      #   encoding:
      #     codec: json
      # logdna:
      #   type: logdna
      #   inputs:
      #     - kubernetes
      #   api_key: "${LOGDNA_API_KEY}"
      #   hostname: portefaix-homelab
      #   healthcheck:
      #     enabled: true
      honeycomb:
        type: honeycomb
        inputs:
          - kubernetes
        api_key: "${HONEYCOMB_API_KEY}"
        dataset: portefaix-homelab
        healthcheck:
          enabled: true
      logzio:
        type: http
        inputs:
          - kubernetes
        uri: https://listener-uk.logz.io:8071/?token=${LOGZIO_TOKEN}&type=vector
        batch:
          max_bytes: 9000000
          timeout_secs: 3
        buffer:
          type: disk
          when_full: block
          max_size: 104900000
        compression: gzip
        encoding:
          codec: ndjson
        healthcheck:
          enabled: true
      papertrail:
        type: papertrail
        inputs:
          - kubernetes
        endpoint: ${PAPERTRAIL_ENDPOINT}
        encoding:
          codec: json
        healthcheck:
          enabled: true
        process: vector
      logtail:
        type: http
        inputs:
          - logtail
        uri: https://in.logtail.com/
        encoding:
          codec: json
        auth:
          strategy: bearer
          token: ${LOGTAIL_TOKEN}
